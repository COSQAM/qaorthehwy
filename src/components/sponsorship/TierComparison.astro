---
import type { SponsorshipTier } from '../../config/sponsorship';

interface Props {
  tiers: SponsorshipTier[];
}

const { tiers } = Astro.props;

// Helper to format price
const formatPrice = (price: number | string) =>
  typeof price === 'number' ? `$${price.toLocaleString()}` : price;

// Build comparison matrix
interface BenefitRow {
  label: string;
  values: (string | boolean)[];
}

const benefitRows: BenefitRow[] = [
  {
    label: 'Booth Location',
    values: tiers.map((t) => t.benefits.boothLocation || '-'),
  },
  {
    label: 'Booth Size',
    values: tiers.map((t) => t.benefits.boothSize || '-'),
  },
  {
    label: 'Website Logo',
    values: tiers.map((t) => t.benefits.logoPlacement.length > 0),
  },
  {
    label: 'Marketing Materials',
    values: tiers.map((t) =>
      t.benefits.logoPlacement.some((p) => p.includes('handout') || p.includes('materials'))
    ),
  },
  {
    label: 'Dedicated Social Media Post',
    values: tiers.map(() => true),
  },
    {
    label: '50% Off T-Shirt Sponsorship',
    values: tiers.map((t) => ['platinum', 'gold'].includes(t.id)),
  },
  {
    label: 'Speaking Opportunity',
    values: tiers.map((t) => t.benefits.guaranteedSpeakingSlot || false),
  },
  {
    label: 'Keynote Sponsorship',
    values: tiers.map((t) => t.benefits.keynoteSponsorship || false),
  },
];
---

<section id="tier-comparison" class="py-24 px-6">
  <div class="container mx-auto max-w-8xl">
    <h2 class="text-4xl md:text-5xl font-bold text-center mb-4 tracking-tight text-dark">
      COMPARE SPONSORSHIP TIERS
    </h2>
    <p class="text-center text-lg text-gray-600 mb-12 max-w-3xl mx-auto">
      Find the perfect sponsorship package for your goals and budget. All tiers include logo placement and attendee access.
    </p>

    <!-- Desktop View: Comparison Table -->
    <div class="hidden lg:block overflow-x-auto">
      <table class="comparison-table w-full border-collapse bg-white rounded-xl shadow-xl overflow-hidden">
        <thead class="sticky top-0 z-10">
          <tr>
            <th class="text-left p-6 bg-gray-100 font-bold text-dark uppercase tracking-wide border-b-2 border-gray-200">
              Benefits
            </th>
            {tiers.map((tier) => (
              <th
                class={`text-center p-6 font-bold uppercase tracking-wide border-b-2 tier-header transition-all ${
                  tier.featured
                    ? 'bg-primary text-white border-primary'
                    : 'bg-gray-100 text-dark border-gray-200'
                }`}
                data-tier={tier.id}
              >
                <div class="text-sm mb-1">{tier.name}</div>
                <div class="text-2xl font-bold">{formatPrice(tier.price)}</div>
                {tier.featured && (
                  <div class="text-xs mt-1 bg-accent text-dark px-2 py-1 rounded-full inline-block">
                    Most Popular
                  </div>
                )}
              </th>
            ))}
          </tr>
        </thead>
        <tbody>
          {benefitRows.map((row, rowIndex) => (
            <tr class={`border-b border-gray-100 ${rowIndex % 2 === 0 ? 'bg-white' : 'bg-gray-50/50'}`}>
              <td class="p-4 font-semibold text-dark">{row.label}</td>
              {row.values.map((value, colIndex) => (
                <td
                  class={`p-4 text-center ${tiers[colIndex].featured ? 'bg-blue-50/30' : ''}`}
                  data-tier={tiers[colIndex].id}
                >
                  {typeof value === 'boolean' ? (
                    value ? (
                      <svg
                        class="w-6 h-6 text-green-600 mx-auto"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                          clip-rule="evenodd"
                        />
                      </svg>
                    ) : (
                      <svg
                        class="w-6 h-6 text-gray-300 mx-auto"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                          clip-rule="evenodd"
                        />
                      </svg>
                    )
                  ) : (
                    <span class="text-dark">{value}</span>
                  )}
                </td>
              ))}
            </tr>
          ))}
        </tbody>
      </table>
    </div>

    <!-- Mobile View: Accordion Cards -->
    <div class="lg:hidden space-y-4">
      {tiers.map((tier) => (
        <div
          class={`tier-accordion-card rounded-xl border-2 overflow-hidden ${
            tier.featured
              ? 'border-primary shadow-lg'
              : 'border-gray-200 shadow-md'
          }`}
        >
          <button
            class={`tier-accordion-header w-full text-left p-6 flex items-center justify-between transition-colors ${
              tier.featured ? 'bg-primary text-white' : 'bg-white text-dark'
            }`}
            data-tier={tier.id}
            aria-expanded="false"
          >
            <div class="flex-1">
              <h3 class="text-xl font-bold uppercase mb-1">{tier.name}</h3>
              <div class="text-2xl font-bold">{formatPrice(tier.price)}</div>
              {tier.featured && (
                <span class="text-xs bg-accent text-dark px-2 py-1 rounded-full inline-block mt-2">
                  Most Popular
                </span>
              )}
            </div>
            <svg
              class={`chevron-icon w-6 h-6 transition-transform ${tier.featured ? 'text-white' : 'text-gray-600'}`}
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"
              />
            </svg>
          </button>
          <div class="tier-accordion-content hidden bg-white p-6">
            <ul class="space-y-4">
              {benefitRows.map((row) => {
                const tierIndex = tiers.findIndex((t) => t.id === tier.id);
                const value = row.values[tierIndex];
                return (
                  <li class="flex items-start justify-between border-b border-gray-100 pb-3">
                    <span class="font-semibold text-dark text-sm">
                      {row.label}
                    </span>
                    <span class="text-right">
                      {typeof value === 'boolean' ? (
                        value ? (
                          <svg
                            class="w-5 h-5 text-green-600"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                              clip-rule="evenodd"
                            />
                          </svg>
                        ) : (
                          <svg
                            class="w-5 h-5 text-gray-300"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                              clip-rule="evenodd"
                            />
                          </svg>
                        )
                      ) : (
                        <span class="text-dark text-sm">{value}</span>
                      )}
                    </span>
                  </li>
                );
              })}
            </ul>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  // Mobile accordion functionality
  document.querySelectorAll('.tier-accordion-header').forEach((header) => {
    header.addEventListener('click', () => {
      const content = header.nextElementSibling as HTMLElement;
      const chevron = header.querySelector('.chevron-icon') as HTMLElement;
      const isExpanded = header.getAttribute('aria-expanded') === 'true';

      // Toggle current accordion
      header.setAttribute('aria-expanded', (!isExpanded).toString());
      content.classList.toggle('hidden');

      // Rotate chevron
      if (content.classList.contains('hidden')) {
        chevron.style.transform = 'rotate(0deg)';
      } else {
        chevron.style.transform = 'rotate(180deg)';
      }
    });
  });

</script>

<style>
  .comparison-table thead {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .tier-accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
  }

  .tier-accordion-content:not(.hidden) {
    max-height: 1000px;
    transition: max-height 0.5s ease-in;
  }
</style>
