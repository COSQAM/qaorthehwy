---
import { sponsorshipConfig } from '../../config/sponsorship';

const tiers = sponsorshipConfig.tiers;
---

<section id="sponsorship-form" class="py-24 px-6">
  <div class="container mx-auto max-w-4xl">
    <div class="bg-white rounded-2xl shadow-2xl p-8 md:p-12 border-2 border-gray-100">
      <h2 class="text-4xl md:text-5xl font-bold text-center mb-4 tracking-tight text-dark">
        REQUEST SPONSORSHIP INFORMATION
      </h2>
      <p class="text-center text-lg text-gray-600 mb-10 max-w-2xl mx-auto">
        Interested in sponsoring QA or the Highway 2026? Fill out the form below and our team will reach out within 24 hours to discuss opportunities.
      </p>

      <form id="sponsorshipForm" class="space-y-6">
        <input type="hidden" name="access_key" value="8193c58a-7cb2-4c62-af39-eb0e75cb7273" />
        <input type="hidden" name="subject" value="Sponsorship Inquiry - QA or the Highway 2026" />
        <input type="hidden" name="from_name" value="QA or the Highway Sponsorship Form" />

        <!-- Company Name -->
        <div>
          <label for="company" class="block text-gray-700 font-semibold mb-2">
            Company Name *
          </label>
          <input
            type="text"
            id="company"
            name="company"
            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:border-primary text-gray-900 transition"
            style="--tw-ring-color: var(--color-primary);"
            required
            placeholder="Your company name"
          />
        </div>

        <!-- Contact Name & Email -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="contact_name" class="block text-gray-700 font-semibold mb-2">
              Contact Name *
            </label>
            <input
              type="text"
              id="contact_name"
              name="contact_name"
              class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:border-primary text-gray-900 transition"
              style="--tw-ring-color: var(--color-primary);"
              required
              placeholder="Your full name"
            />
          </div>
          <div>
            <label for="email" class="block text-gray-700 font-semibold mb-2">
              Email Address *
            </label>
            <input
              type="email"
              id="email"
              name="email"
              class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:border-primary text-gray-900 transition"
              style="--tw-ring-color: var(--color-primary);"
              required
              placeholder="your@email.com"
            />
          </div>
        </div>

        <!-- Phone -->
        <div>
          <label for="phone" class="block text-gray-700 font-semibold mb-2">
            Phone Number
          </label>
          <input
            type="tel"
            id="phone"
            name="phone"
            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:border-primary text-gray-900 transition"
            style="--tw-ring-color: var(--color-primary);"
            placeholder="(123) 456-7890"
          />
        </div>

        <!-- Tier Interest (Checkboxes) -->
        <div>
          <label class="block text-gray-700 font-semibold mb-3">
            Interested Sponsorship Tier(s) *
          </label>
          <p class="text-sm text-gray-600 mb-4">Select all that apply</p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            {tiers.map((tier) => (
              <label class="flex items-start cursor-pointer group">
                <input
                  type="checkbox"
                  name={`tier_${tier.id}`}
                  value={tier.name}
                  class="w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary focus:ring-2 mt-0.5"
                />
                <span class="ml-3 text-gray-700 group-hover:text-primary transition">
                  <span class="font-semibold">{tier.name}</span>
                  {' - '}
                  <span class="text-gray-600">
                    {typeof tier.price === 'number'
                      ? `$${tier.price.toLocaleString()}`
                      : tier.price}
                  </span>
                </span>
              </label>
            ))}
          </div>
        </div>

        <!-- Budget Range -->
        <div>
          <label for="budget" class="block text-gray-700 font-semibold mb-2">
            Approximate Budget Range
          </label>
          <div class="relative">
            <select
              id="budget"
              name="budget"
              class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:border-primary text-gray-900 bg-white appearance-none pr-10 transition"
              style="--tw-ring-color: var(--color-primary);"
            >
              <option value="">Select a range</option>
              <option value="under-1000">Under $1,000</option>
              <option value="1000-2500">$1,000 - $2,500</option>
              <option value="2500-5000">$2,500 - $5,000</option>
              <option value="over-5000">Over $5,000</option>
              <option value="flexible">Flexible / Not sure</option>
            </select>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-700">
              <svg class="fill-current h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Message -->
        <div>
          <label for="message" class="block text-gray-700 font-semibold mb-2">
            Questions or Special Requests
          </label>
          <textarea
            id="message"
            name="message"
            rows="5"
            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:border-primary text-gray-900 transition"
            style="--tw-ring-color: var(--color-primary);"
            placeholder="Tell us about your goals, timeline, or any specific questions..."
          ></textarea>
        </div>

        <!-- Submit Button -->
        <div class="flex flex-col items-center gap-4">
          <button
            type="submit"
            class="w-full md:w-auto btn-primary px-12 py-4 rounded-xl text-lg font-bold transition transform hover:scale-105 shadow-lg shadow-blue-500/30"
          >
            Submit Inquiry
          </button>
          <p class="text-sm text-gray-600 text-center">
            We respond to all inquiries within 24 business hours
          </p>
        </div>

        <div id="result" class="text-center font-semibold mt-6"></div>
      </form>
    </div>

    <!-- Direct Contact Info -->
    <div class="mt-12 text-center">
      <p class="text-gray-700 mb-2">
        Prefer to reach out directly?
      </p>
      <a
        href="mailto:cosqam@gmail.com?subject=Sponsorship Inquiry - QA or the Highway 2026"
        class="text-primary font-semibold hover:underline text-lg"
      >
        cosqam@gmail.com
      </a>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById('sponsorshipForm') as HTMLFormElement;
  const result = document.getElementById('result') as HTMLDivElement;

  // Pre-populate tier from URL parameter
  const urlParams = new URLSearchParams(window.location.search);
  const tierParam = urlParams.get('tier');
  if (tierParam) {
    const checkbox = document.querySelector(
      `input[name="tier_${tierParam}"]`
    ) as HTMLInputElement;
    if (checkbox) {
      checkbox.checked = true;
      checkbox.focus();
    }
  }

  form.addEventListener('submit', async (event) => {
    event.preventDefault();

    // Check if at least one tier is selected
    const tierCheckboxes = form.querySelectorAll('input[name^="tier_"]:checked');
    if (tierCheckboxes.length === 0) {
      result.textContent = "Please select at least one tier of interest";
      result.className = "text-center font-semibold text-red-600 mt-6";
      return;
    }

    result.textContent = "Sending your inquiry...";
    result.className = "text-center font-semibold text-gray-600 mt-6";

    const formData = new FormData(form);

    try {
      const response = await fetch("https://api.web3forms.com/submit", {
        method: "POST",
        body: formData
      });

      const data = await response.json();

      if (data.success) {
        result.textContent =
          "Thank you for your interest! Our sponsorship team will reach out within 24 hours to discuss opportunities.";
        result.className = "text-center font-semibold text-green-600 mt-6";
        form.reset();
      } else {
        result.textContent = "Error: " + (data.message || "Something went wrong");
        result.className = "text-center font-semibold text-red-600 mt-6";
      }
    } catch (error) {
      result.textContent = "Error: Unable to submit form. Please try emailing us directly.";
      result.className = "text-center font-semibold text-red-600 mt-6";
    }
  });
</script>
